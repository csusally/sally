---
date: "2018-03-12"
title: "Netlify 将静态网站部署在CDN上"
category: "Serverless Architecture"
tags: ['static website', 'CDN', 'cache']
banner: ""
---



> 在计算机科学中有两个难解决的问题：缓存失效和命名。

及时缓存失效是Netlify非常重要的一个方面。下面将讨论一下及时缓存失效的重要性。

## 缓存失效

一个现代的静态网站比传统的动态网站体现出的巨大优势是前者可以被部署发布在CDN上。这意味着你不必限制于将网站部署在一个特定的服务器上，而是可以让你的网站在世界上的每个角落。这使得网站打开的更快速，平均打开时间小于优化的动态网站的1/10.
然而这样快的速度同时伴随着缓存失效相关的问题。在cdn，你的网站存在本地缓存中，但是当你的网站更新时，变更的文件需要及时的在本地缓存中更新。因此你得（或者网站服务器、你使用的构建工具）告诉cdn服务去丢弃旧文件，用新的文件去代替他。这就是所谓的缓存失效：清理缓存，用新的文件代替旧的文件。

## 问题的出现
除了Netlify, 其他所有静态网站（本质上是缓存的站点）的CDN宿主服务器将会放你等10分到几个小时才能看到网站的更新。换句话说，只要你更新网站，你只能等待它生效。
缓慢的缓存失效时间是静态网站最重要的一个问题之一，还有一个主要的原因是很多人还是会坚持选择传统的动态网站，动态网站在服务器上不断的build，因此他们在某种程度上不必担心缓存失效的问题。
但是每次在服务上build的问题也正是我们想要使用现代静态网站替代的原因，这样文件就不必每次都重新build，这样，它们部署在CDN上，更快速、安全而且成本更低。

一个折中的解决方案是重写每个更新的文件的url：

对于css、js或者图片的文件，可以通过更新url使得缓存中的文件更新。这可以解决资源文件的缓存失效，但是对于html文件来说是个困难的事，你还必须更新文件的headers信息。
大部分的CDN服务你只能在缓存无效或等待缓存失效之间选择，或者不对html文件缓存，但是这样你就不能在那些问价中利用缓存的优势。

## 解决方案

利用Netlify 可以优雅的解决上面的问题。Netlify是仅有的可以提供及时缓存更新的CDN主机服务。为了页面的加载速度最小并且有最高的缓存命中率，通过真正及时缓存失效的方案，Netlify是一个多层的CDN.因此，你获得了一个高缓存的超级快速的缓存站点，同时，只要网站有更新你就会立即看到你提交的更新。

## 技术实现部分
当你部署一个站点时，Netlify对所有的资源文件的链接建立了指纹，而且直接将他们放在Akamai（阿卡迈 cdn服务提供商）上，并且告知浏览器和Akamai对他们永久的缓存。Akamai有世界上最大的CDN的基础建设，因此可以通过从用户最近的服务而对对这些资源文件提供非常好的传输性能。
然而，真正的HTML文件被放在我么自己的特殊用途的CDN上面。它被高度优化到具有超高的缓存命中率、最快加载速度以使得更新能够及时的响应。


翻译自：
https://www.netlify.com/blog/2015/09/11/instant-cache-invalidation/
